# Roadmap: Система AI-Скорингу та Управління Ресурсами

## Мета
Перехід від моделі "AI для кожного запиту" до моделі "Proof of Importance", де пріоритет обробки визначається спільнотою, кредитами або власними ресурсами користувачів, з повним дотриманням анонімності.

---

## Етап 1: Інфраструктура черги та анонімні квоти (Foundation)
* **[DB] Впровадження пріоритетів**:
    * Додати поле `priorityScore: Int` до моделі `Revision`.
    * Створити таблицю `AiRequestQueue` для відстеження статусу обробки (PENDING, PROCESSING, COMPLETED, FAILED).
* **[Logic] Анонімний Rate Limiting**:
    * Реалізувати перевірку квот на основі `pHash` (наприклад, 3 безкоштовні скоринги на добу).
    * Використовувати Redis або таблицю квот для відстеження лімітів без прив'язки до IP.
* **[Worker] Фоновий обробник**:
    * Створити Cron-задачу або Worker, який раз на 5-10 хвилин вибирає ТОП-N ревізій з найбільшим `priorityScore` для відправки в LLM.

## Етап 2: Демократичний скоринг (Community Voting)
* **[API] Механіка голосування**:
    * Створити ендпоінт `POST /revisions/:id/vote`.
    * Голос від користувача з високою репутацією додає більше балів до `priorityScore`.
* **[Logic] Scoring Consensus**:
    * Впровадити поріг (threshold): якщо ревізія набирає X балів пріоритету, вона автоматично стає наступною в черзі на AI-аналіз.
    * Реалізувати логіку `auto-approve`: автоматичне схвалення при AI-score > 85.

## Етап 3: Кредити та власні API ключі (Resource Sharing)
* **[Security] Encrypted Vault**:
    * Створити систему збереження `userApiKey` (OpenAI/Anthropic) за допомогою AES-256-GCM.
    * Ключ дешифрується лише в момент виконання запиту в пам'яті (runtime).
* **[Logic] Система "Податку" на ресурси (Taxation)**:
    * Користувач з власним ключем обробляє свої запити миттєво.
    * **Taxing Policy**: Кожен N-й запит (наприклад, 20%) через ключ користувача виконує задачу з загальної черги (Community Task).
* **[Fintech] Система Кредитів**:
    * Додати поле `credits` до моделі `User`.
    * Витрата кредиту = миттєвий підйом ревізії в початок черги без очікування голосів.

## Етап 4: Безпека та Оптимізація (Sandboxing)
* **[Security] Prompt Injection Protection**:
    * Валідація та очищення даних ревізії перед відправкою в LLM, щоб уникнути спроб маніпуляції через "власні ключі".
* **[Ops] Cost Monitoring**:
    * Дашборд для адміна: скільки запитів оброблено за рахунок системи, а скільки — за рахунок ключів користувачів.

---

### Технічний стек для реалізації:
- **Database**: Prisma (PostgreSQL).
- **Encryption**: Node.js `crypto` module.
- **Queue**: BullMQ або проста черга на рівні БД.
- **AI Integration**: LangChain або прямі SDK (OpenAI/Anthropic).